<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMP Practice Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #2c5aa0;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .test-selection {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .test-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .test-btn {
            background: #2c5aa0;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
        }

        .test-btn:hover {
            background: #1e3f73;
        }

        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .options {
            margin: 20px 0;
        }

        .option {
            margin: 10px 0;
        }

        .option label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }

        .timer {
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 18px;
        }

        .test-interface {
            display: none;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .test-header {
            background: #2c5aa0;
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .question-container {
            padding: 30px;
        }

        .question {
            margin-bottom: 20px;
        }

        .question h3 {
            color: #2c5aa0;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .question-text {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #2c5aa0;
        }

        .options-container {
            margin: 20px 0;
        }

        .option-item {
            margin: 10px 0;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option-item:hover {
            border-color: #2c5aa0;
            background: #f0f4f8;
        }

        .option-item.selected {
            border-color: #2c5aa0;
            background: #e3f2fd;
        }

        .option-item.correct {
            border-color: #27ae60;
            background: #d5f4e6;
        }

        .option-item.incorrect {
            border-color: #e74c3c;
            background: #fdeaea;
        }

        .option-label {
            font-weight: bold;
            margin-right: 10px;
            color: #2c5aa0;
        }

        .feedback {
            display: none;
            margin: 20px 0;
            padding: 20px;
            border-radius: 6px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
        }

        .feedback.show {
            display: block;
        }

        .feedback h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-top: 1px solid #e0e0e0;
        }

        .nav-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .nav-btn:hover:not(:disabled) {
            background: #5a6268;
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .nav-btn.primary {
            background: #2c5aa0;
        }

        .nav-btn.primary:hover:not(:disabled) {
            background: #1e3f73;
        }

        .domain-progress {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .domain-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }

        .domain-card h4 {
            color: #2c5aa0;
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-fill {
            height: 100%;
            background: #27ae60;
            transition: width 0.3s;
        }

        .results {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .results.show {
            display: block;
        }

        .results h2 {
            color: #2c5aa0;
            text-align: center;
            margin-bottom: 30px;
        }

        .score-summary {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .score-number {
            font-size: 48px;
            font-weight: bold;
            color: #2c5aa0;
        }

        .score-percentage {
            font-size: 24px;
            color: #666;
            margin-top: 10px;
        }

        .domain-results {
            margin: 30px 0;
        }

        .domain-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .recommendations {
            margin: 30px 0;
            padding: 20px;
            background: #e8f4fd;
            border-radius: 6px;
            border-left: 4px solid #2c5aa0;
        }

        .restart-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            display: block;
            margin: 20px auto;
        }

        .restart-btn:hover {
            background: #219a52;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .test-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .progress-info {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PMP Practice Test</h1>
            <p>Project Management Professional Certification Practice Exam</p>
            <p>180 Questions â€¢ 3 Test Versions Available â€¢ Domain-Based Scoring</p>
        </div>

        <div id="testSelection" class="test-selection">
            <h2>Select Your Practice Test</h2>
            <p>Choose from three different test versions, each with unique questions covering the same PMP concepts.</p>
            
            <div class="test-buttons">
                <button class="test-btn" onclick="startTest(1)">Test Version A</button>
                <button class="test-btn" onclick="startTest(2)">Test Version B</button>
                <button class="test-btn" onclick="startTest(3)">Test Version C</button>
            </div>

            <div class="options">
                <div class="option">
                    <label>
                        <input type="checkbox" id="timerEnabled" checked>
                        Enable Timer (230 minutes)
                    </label>
                </div>
                <div class="option">
                    <label>
                        <input type="checkbox" id="immediateSubmitFeedback" checked>
                        Show immediate feedback on incorrect answers
                    </label>
                </div>
            </div>

            <div class="domain-progress">
                <div class="domain-card">
                    <h4>Domain I: People (42%)</h4>
                    <p>76 questions covering team leadership, conflict resolution, and stakeholder engagement</p>
                </div>
                <div class="domain-card">
                    <h4>Domain II: Process (50%)</h4>
                    <p>90 questions covering project planning, execution, and monitoring</p>
                </div>
                <div class="domain-card">
                    <h4>Domain III: Business Environment (8%)</h4>
                    <p>14 questions covering compliance, business value, and organizational change</p>
                </div>
            </div>
        </div>

        <div id="testInterface" class="test-interface">
            <div class="test-header">
                <div class="progress-info">
                    <span id="questionProgress">Question 1 of 180</span>
                    <span id="domainInfo">Domain I: People</span>
                </div>
                <div class="timer-controls">
                    <div id="timer" class="timer">230:00</div>
                </div>
            </div>

            <div class="question-container">
                <div class="question">
                    <h3 id="questionTitle">Question 1</h3>
                    <div id="questionText" class="question-text"></div>
                    <div id="optionsContainer" class="options-container"></div>
                    <div id="feedback" class="feedback">
                        <h4>Explanation</h4>
                        <p id="feedbackText"></p>
                    </div>
                </div>
            </div>

            <div class="navigation">
                <button id="prevBtn" class="nav-btn" onclick="previousQuestion()" disabled>Previous</button>
                <div>
                    <button id="submitBtn" class="nav-btn primary" onclick="submitAnswer()">Submit Answer</button>
                    <button id="nextBtn" class="nav-btn" onclick="nextQuestion()" disabled>Next</button>
                </div>
                <button id="finishBtn" class="nav-btn primary" onclick="finishTest()" style="display: none;">Finish Test</button>
            </div>
        </div>

        <div id="results" class="results">
            <h2>Test Results</h2>
            <div class="score-summary">
                <div id="scoreNumber" class="score-number">0</div>
                <div class="score-percentage">
                    <span id="scorePercentage">0%</span> Correct
                    <div>(<span id="correctCount">0</span> out of 180 questions)</div>
                </div>
            </div>

            <div class="domain-results">
                <h3>Performance by Domain</h3>
                <div id="domainResults"></div>
            </div>

            <div id="recommendations" class="recommendations">
                <h4>Study Recommendations</h4>
                <div id="recommendationText"></div>
            </div>

            <button class="restart-btn" onclick="restartTest()">Take Another Test</button>
        </div>
    </div>

    <script>
        // Test data structure - simplified for demonstration
        const testQuestions = {
            1: [ // Test Version A
                {
                    id: "840664",
                    domain: "I.6",
                    domainName: "People",
                    question: "A project manager joins a project team, replacing a manager who left. During initial meetings, the project manager realized that the team members have differing opinions about how to address technical decisions. Team members did NOT respect each other's ideas, and the environment was becoming counterproductive. However, now with the new manager's leadership, the team has begun to communicate more effectively and develop some processes and procedures for working together. In what phase of development is the team now?",
                    options: ["Forming", "Storming", "Norming", "Performing"],
                    correct: 2,
                    feedback: "During the norming phase, team members begin to work together and adjust their work habits and behaviors to support the team. The team members learn to trust each other."
                },
                {
                    id: "840679",
                    domain: "I.6",
                    domainName: "People",
                    question: "A project is comprised of three highly dependent parts, each being completed by its own project team. The team leader, worried that conflicts might arise when the outputs from the three teams are combined, asks for advice. What advice should the project manager provide?",
                    options: [
                        "Identify potential conflicts and then arrange for a weekly joint meeting with the members of the three teams to review each other's work.",
                        "Decide which team's work should be prioritized, then delay the work from the other two teams to ensure there are NO conflicts.",
                        "Document conflicts as they occur and take action to remedy any problems that arise.",
                        "Continue to let all three teams work simultaneously, recognizing that conflicts can be addressed at the testing phase."
                    ],
                    correct: 0,
                    feedback: "Consistent communication is important for ensuring a lower probability of issues and successfully addressing existing risks."
                },
                {
                    id: "840649",
                    domain: "II.5",
                    domainName: "Process",
                    question: "A project that should have been 90% complete by now is only 65% complete. The total project budget is US$120,000 and the actual cost spent to date (AC) is US$80,000. What is the scheduled performance index (SPI) and cost performance index (CPI) of this project?",
                    options: [
                        "The SPI is 0.72, and the CPI is 0.98.",
                        "The SPI is 1.38, and the CPI is 1.2.",
                        "The SPI is 0.94, and the CPI is 1.04.",
                        "The SPI is 0.80, and the CPI is 0.91."
                    ],
                    correct: 0,
                    feedback: "EV = % complete * budget: 65% * $120,000 = $78,000, AC = $80,000. CPI = EV/AC = $78,000/80,000 = 0.975 or 0.98. A CPI less than 1 means the project is over budget. PV = % complete * budget: 90% * $120,000 = $108,000, SPI = EV/PV = $78,000/108,000 = 0.72. An SPI less than 1 means the project is behind schedule."
                },
                {
                    id: "840697",
                    domain: "III.1",
                    domainName: "Business Environment",
                    question: "A new law is expected within the next 6 months that will affect a business' product line. The next product is launching and should be completed within 3 months. Unfortunately, the new product will NOT meet the requirements of the proposed law. How should the project manager respond to this potential problem?",
                    options: [
                        "Schedule a meeting with the sponsor and key stakeholders to discuss risks. Then, using the results of the meeting, revise the assumption log and project charter.",
                        "Revise the risk management plan. Then, move ahead with planning the project.",
                        "Move ahead with the project, following the plan. Then ensure on-time completion, so that the product will NOT be affected by any possible rule change.",
                        "Schedule a meeting with the sponsor and key stakeholders to warn them about the law. Then advise them to cancel the project until the legislation is finalized."
                    ],
                    correct: 0,
                    feedback: "This new law can have a profound effect on the project. It will certainly lead to new potential risks, new assumptions, and a possible charter change."
                }
                // Add more questions here to reach 180 total
            ],
            2: [ // Test Version B - Different questions testing same concepts
                {
                    id: "X00003",
                    domain: "I.6",
                    domainName: "People",
                    question: "A project manager has assembled a project team. During initial meetings, the project manager observes that team members are getting to know each other, feeling excited and positive about the project, and have NOT been told the specific details of the project. In what phase of development is the team?",
                    options: ["Storming", "Norming", "Forming", "Performing"],
                    correct: 2,
                    feedback: "The Forming phase is when the team members meet and learn about the project and their formal roles and responsibilities. Team members tend to be solitary and independent in this phase."
                },
                {
                    id: "844765",
                    domain: "I.6", 
                    domainName: "People",
                    question: "Three project teams are working on parts of a single project. The parts are highly dependent on each other. The leader of the team indicates that this might create conflicts when the outputs from the three teams are combined. What guidance should the project manager offer to the team lead?",
                    options: [
                        "Identify potential conflicts and arrange for a weekly joint meeting with the members of the three teams to monitor each other's work.",
                        "Decide which team's work should be prioritized, then delay the work from the other two teams to ensure there are NO conflicts.",
                        "Document conflicts as they occur and take action to remedy any problems that arise.",
                        "Tell all three teams to continue to work simultaneously, recognizing that conflicts can be addressed at the testing phase."
                    ],
                    correct: 0,
                    feedback: "Before deciding to act, the project manager needs to determine the potential conflicts and monitor progress."
                },
                {
                    id: "844455",
                    domain: "II.5",
                    domainName: "Process", 
                    question: "A project that should have been 90% complete by now is only 84% complete. The total project budget is US$110,000 and the actual cost to date is US$82,000. What is the schedule performance index (SPI) and cost performance index (CPI) for this project?",
                    options: [
                        "The SPI is 0.93, and the CPI is 1.13.",
                        "The SPI is 1.07, and the CPI is 0.99.",
                        "The SPI is 1.15, and the CPI of 0.93.",
                        "The SPI is 0.96, and the CPI is 1.18."
                    ],
                    correct: 0,
                    feedback: "EV = Actual% * BAC = 0.84*$110,000 = $92,400, PV = Plan% * BAC = 0.90*$110,000 = $99,000, AC = $82,000 (given). SPI = EV/PV = $92,400/$99,000 = 0.93, CPI = EV/AC = $92,400/$82,000 = 1.126 or 1.13"
                },
                {
                    id: "840778",
                    domain: "III.1",
                    domainName: "Business Environment",
                    question: "A project team learns about a new compliance requirement from an international entity that may impact the baseline business case for the project. They learn this right after the project charter is completed and the project sponsor has signed. How should the project manager proceed?",
                    options: [
                        "Research the requirement and possible consequences, then give the sponsor a recommendation.",
                        "Address the requirement through the creation of a quality management plan.",
                        "Ignore the issue, as the new requirement is NOT part of the project's documented scope.",
                        "Ensure that the requirement is documented in the risk register, then ask for further guidance from all stakeholders."
                    ],
                    correct: 0,
                    feedback: "The context of this scenario requires the project manager to influence the organization (sponsor) and recommend next steps after reviewing and understanding compliance requirements and consequences."
                }
                // Add more questions here to reach 180 total
            ],
            3: [ // Test Version C - Different questions testing same concepts
                {
                    id: "A00202",
                    domain: "I.10",
                    domainName: "People",
                    question: "A newly assembled project team is holding a kickoff meeting over a weekend. About half of the project team already works together; the other team members are contractors. The company already uses lean and agile approaches. However, during the meeting, the team members openly argued about everythingâ€”from project goals to the smallest details. Which action will help the team to build a shared understanding?",
                    options: [
                        "Create breakout sessions and assign team members to specific work based on their expertise.",
                        "Nominate someone to the role of project manager and adopt a hierarchical team structure.",
                        "Ask the product owner to lead the session and explain to the team what to do.",
                        "The team lead should arrange the team and contractors in working pairs."
                    ],
                    correct: 2,
                    feedback: "This team is in the storming phase, so arguments may be normal. However, they need to refocus and come together sooner rather than later. The team should collaborate, and at this stage the product owner is best qualified to offer some cohesion."
                },
                {
                    id: "A00081",
                    domain: "I.6",
                    domainName: "People",
                    question: "An R&D executive, who is a project stakeholder, occasionally visits the agile team's work area to give instructions about urgent feature work. The team begins work. During sprint reviews, the product owner becomes upset that the team worked on the requested features. How should the team address the problem?",
                    options: [
                        "Escalate to ensure that the executive no longer interferes with the team.",
                        "Meet with the executive and product owner to agree on a work flow.",
                        "Require that the executive issues change requests for new items.",
                        "Give the executive access to add new items to the backlog."
                    ],
                    correct: 1,
                    feedback: "In this case, the R&D executive stakeholder is bypassing the product owner and creating disruption. A working agreement between the executive and the product owner is needed to restore order."
                },
                {
                    id: "844452",
                    domain: "II.5",
                    domainName: "Process",
                    question: "A project that should have been 70% complete by now is only 55% complete. The total project budget is US$210,000, and the actual cost spent to date is US$162,000. What is the scheduled performance index (SPI) and cost performance index (CPI) of this project?",
                    options: [
                        "The SPI is 0.79, and the CPI is 0.71.",
                        "The SPI is 1.27, and the CPI is 0.98.",
                        "The SPI is 0.82, and the CPI is 1.05.",
                        "The SPI is 0.99, and the CPI is 0.96."
                    ],
                    correct: 0,
                    feedback: "EV = Actual% * BAC = 0.55*$210,000 = $115,500, PV = Plan% * BAC = 0.70*$210,000 = $147,000, AC = $162,000 (given). SPI = EV/PV = $115,500/$147,000 = 0.785 or 0.79, CPI = EV/AC = $115,500/$162,000 = 0.71"
                },
                {
                    id: "A00092",
                    domain: "III.1",
                    domainName: "Business Environment",
                    question: "The legal team informs the product owner that another company owns a patent for an innovation used in the agile team's product, which is now 75% complete. What should the product owner do to determine the appropriate way forward?",
                    options: [
                        "Work with the legal department to find markets where the patent is NOT registered.",
                        "Perform marginal economics analysis and identify minimum releasable features.",
                        "Terminate the project immediately to prevent any further sunken costs.",
                        "Continue work on the product after removing the patented component."
                    ],
                    correct: 1,
                    feedback: "A foundational assumption to release the product has become a 'show-stopper'. Marginal economic analysis determines if there is a viable way forward. Identifying minimal releasable features can mitigate the economic loss."
                }
                // Add more questions here to reach 180 total
            ]
        };

        // Generate additional questions for each test to reach 180 total
        function generateAdditionalQuestions() {
            // This would include all 269 questions distributed across the three tests
            // For demonstration, we'll use a simplified version
            const additionalQuestions = [
                // People domain questions
                {
                    id: "sample_people_1",
                    domain: "I.12",
                    domainName: "People",
                    question: "A project manager needs stakeholder involvement in order to identify strategic and operational assumptions and constraints. Unfortunately, the project manager is having difficulty obtaining consistent input due to lack of participation. In which two ways can the project manager encourage the stakeholder to participate and collaborate? (Choose TWO.)",
                    options: ["Use political awareness techniques", "Be a servant leader", "Timebox meetings", "Use effective facilitation techniques"],
                    correct: [3, 1], // Multiple correct answers
                    multiSelect: true,
                    feedback: "Facilitation is the ability to effectively guide a group event to a successful decision, solution, or conclusion. Being a servant leader also helps encourage participation."
                },
                // Process domain questions  
                {
                    id: "sample_process_1",
                    domain: "II.3",
                    domainName: "Process",
                    question: "A project sponsor is risk averse and is therefore concerned about negative impacts on the project. To help with this concern, the project team identifies four (4) project risks and then evaluates both the probability of occurrence and the impact of the risk if it occurs. The team uses a 1-5 scale (1 is the lowest and 5 is the highest). Based on the following data, in what order should the project manager rank these risks? Risk A: Probability 1, Impact 5; Risk B: Probability 4, Impact 4; Risk C: Probability 2, Impact 5; Risk D: Probability 2, Impact 2",
                    options: ["B, A, D, C", "B, C, A, D", "B, A, C, D", "C, D, A, B"],
                    correct: 1,
                    feedback: "Risk severity is calculated by multiplying probability and impact. Risk B (4Ã—4=16), Risk C (2Ã—5=10), Risk A (1Ã—5=5), Risk D (2Ã—2=4). The higher the value, the higher the risk is rated."
                },
                // Business Environment questions
                {
                    id: "sample_business_1", 
                    domain: "III.3",
                    domainName: "Business Environment",
                    question: "A company is losing market share to disruptive competitors with new business models. A cross-functional agile team has been formed to recommend ways to recover market share. How can the team increase their chance of producing successful recommendations?",
                    options: [
                        "Gain a deep understanding of why customers are disappointed by the company's products.",
                        "Focus on enabling profitable delivery of unique, high-quality, and innovative products.",
                        "Understand how the competitors' business models can reach more consumers at a lower cost.",
                        "Focus on understanding the value consumers seek and the value competitors offer."
                    ],
                    correct: 3,
                    feedback: "The first principle of the Agile Manifesto focuses on value: 'Our highest priority is to satisfy the customer through early and continuous delivery of valuable software.' Markets are driven by the value consumers attribute to the offerings."
                }
            ];

            // Distribute additional questions across the three tests to reach 180 each
            for (let testNum = 1; testNum <= 3; testNum++) {
                while (testQuestions[testNum].length < 180) {
                    // Add variations of the additional questions
                    additionalQuestions.forEach(question => {
                        if (testQuestions[testNum].length < 180) {
                            testQuestions[testNum].push({
                                ...question,
                                id: `${question.id}_v${testNum}_${testQuestions[testNum].length}`
                            });
                        }
                    });
                }
            }
        }

        // Generate the full question sets
        generateAdditionalQuestions();

        // Application state
        let currentTest = 1;
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let testStartTime = null;
        let timerInterval = null;
        let timeRemaining = 230 * 60; // 230 minutes in seconds
        let testCompleted = false;

        // Domain mappings
        const domainInfo = {
            'I': { name: 'People', weight: 0.42, questions: 76 },
            'II': { name: 'Process', weight: 0.50, questions: 90 },
            'III': { name: 'Business Environment', weight: 0.08, questions: 14 }
        };

        // Load saved progress
        function loadProgress() {
            const saved = localStorage.getItem('pmp_test_progress');
            if (saved) {
                const data = JSON.parse(saved);
                currentTest = data.currentTest || 1;
                currentQuestionIndex = data.currentQuestionIndex || 0;
                userAnswers = data.userAnswers || {};
                timeRemaining = data.timeRemaining || 230 * 60;
                
                if (data.testStartTime && !testCompleted) {
                    // Resume test
                    document.getElementById('testSelection').style.display = 'none';
                    document.getElementById('testInterface').style.display = 'block';
                    showQuestion();
                    if (document.getElementById('timerEnabled').checked) {
                        startTimer();
                    }
                }
            }
        }

        // Save progress
        function saveProgress() {
            const data = {
                currentTest,
                currentQuestionIndex,
                userAnswers,
                timeRemaining,
                testStartTime
            };
            localStorage.setItem('pmp_test_progress', JSON.stringify(data));
        }

        // Start test
        function startTest(testNumber) {
            currentTest = testNumber;
            currentQuestionIndex = 0;
            userAnswers = {};
            testStartTime = Date.now();
            timeRemaining = 230 * 60;
            testCompleted = false;

            document.getElementById('testSelection').style.display = 'none';
            document.getElementById('testInterface').style.display = 'block';
            
            showQuestion();
            
            if (document.getElementById('timerEnabled').checked) {
                startTimer();
            }
            
            saveProgress();
        }

        // Timer functions
        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                saveProgress();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    alert('Time is up! The test will now be submitted automatically.');
                    finishTest();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timer').textContent = display;
            
            // Change color as time runs low
            const timerElement = document.getElementById('timer');
            if (timeRemaining < 1800) { // Last 30 minutes
                timerElement.style.background = '#e74c3c';
            } else if (timeRemaining < 3600) { // Last hour
                timerElement.style.background = '#f39c12';
            }
        }

        // Show current question
        function showQuestion() {
            const questions = testQuestions[currentTest];
            const question = questions[currentQuestionIndex];
            
            // Update progress info
            document.getElementById('questionProgress').textContent = 
                `Question ${currentQuestionIndex + 1} of ${questions.length}`;
            
            const domainKey = question.domain.split('.')[0];
            document.getElementById('domainInfo').textContent = 
                `Domain ${domainKey}: ${question.domainName}`;
            
            // Show question
            document.getElementById('questionTitle').textContent = 
                `Question ${currentQuestionIndex + 1}`;
            document.getElementById('questionText').textContent = question.question;
            
            // Show options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option-item';
                optionDiv.onclick = () => selectOption(index);
                
                const isSelected = question.multiSelect 
                    ? (userAnswers[question.id] && userAnswers[question.id].includes(index))
                    : userAnswers[question.id] === index;
                
                if (isSelected) {
                    optionDiv.classList.add('selected');
                }
                
                optionDiv.innerHTML = `
                    <span class="option-label">${String.fromCharCode(65 + index)}.</span>
                    ${option}
                `;
                
                optionsContainer.appendChild(optionDiv);
            });
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').disabled = 
                currentQuestionIndex === questions.length - 1 || !userAnswers[question.id];
            
            // Show finish button on last question
            if (currentQuestionIndex === questions.length - 1) {
                document.getElementById('finishBtn').style.display = 'block';
            } else {
                document.getElementById('finishBtn').style.display = 'none';
            }
            
            // Hide feedback initially
            document.getElementById('feedback').classList.remove('show');
            
            // Update submit button
            const submitBtn = document.getElementById('submitBtn');
            if (userAnswers[question.id] !== undefined) {
                submitBtn.textContent = 'Change Answer';
            } else {
                submitBtn.textContent = 'Submit Answer';
            }
        }

        // Select option
        function selectOption(index) {
            const questions = testQuestions[currentTest];
            const question = questions[currentQuestionIndex];
            
            if (question.multiSelect) {
                // Handle multiple selection
                if (!userAnswers[question.id]) {
                    userAnswers[question.id] = [];
                }
                
                const answers = userAnswers[question.id];
                const existingIndex = answers.indexOf(index);
                
                if (existingIndex > -1) {
                    answers.splice(existingIndex, 1);
                } else {
                    answers.push(index);
                }
                
                if (answers.length === 0) {
                    delete userAnswers[question.id];
                }
            } else {
                // Handle single selection
                userAnswers[question.id] = index;
            }
            
            showQuestion();
            saveProgress();
        }

        // Submit answer
        function submitAnswer() {
            const questions = testQuestions[currentTest];
            const question = questions[currentQuestionIndex];
            const userAnswer = userAnswers[question.id];
            
            if (userAnswer === undefined) {
                alert('Please select an answer before submitting.');
                return;
            }
            
            // Show feedback if immediate feedback is enabled and answer is incorrect
            const isCorrect = question.multiSelect 
                ? arraysEqual(userAnswer.sort(), question.correct.sort())
                : userAnswer === question.correct;
            
            if (document.getElementById('immediateSubmitFeedback').checked && !isCorrect) {
                showFeedback(question, userAnswer);
            }
            
            // Enable next button
            document.getElementById('nextBtn').disabled = false;
            
            // Update submit button
            document.getElementById('submitBtn').textContent = 'Change Answer';
            
            saveProgress();
        }

        // Show feedback
        function showFeedback(question, userAnswer) {
            const feedbackDiv = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedbackText');
            
            feedbackText.textContent = question.feedback;
            feedbackDiv.classList.add('show');
            
            // Highlight correct and incorrect options
            const optionItems = document.querySelectorAll('.option-item');
            optionItems.forEach((item, index) => {
                item.classList.remove('correct', 'incorrect');
                
                if (question.multiSelect) {
                    if (question.correct.includes(index)) {
                        item.classList.add('correct');
                    } else if (userAnswer && userAnswer.includes(index)) {
                        item.classList.add('incorrect');
                    }
                } else {
                    if (index === question.correct) {
                        item.classList.add('correct');
                    } else if (index === userAnswer) {
                        item.classList.add('incorrect');
                    }
                }
            });
        }

        // Navigation functions
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
                saveProgress();
            }
        }

        function nextQuestion() {
            const questions = testQuestions[currentTest];
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
                saveProgress();
            }
        }

        // Finish test
        function finishTest() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            testCompleted = true;
            
            // Calculate results
            const results = calculateResults();
            
            // Hide test interface
            document.getElementById('testInterface').style.display = 'none';
            
            // Show results
            showResults(results);
            
            // Clear saved progress
            localStorage.removeItem('pmp_test_progress');
        }

        // Calculate results
        function calculateResults() {
            const questions = testQuestions[currentTest];
            let totalCorrect = 0;
            const domainScores = {};
            
            // Initialize domain scores
            Object.keys(domainInfo).forEach(domain => {
                domainScores[domain] = { correct: 0, total: 0 };
            });
            
            questions.forEach(question => {
                const domainKey = question.domain.split('.')[0];
                const userAnswer = userAnswers[question.id];
                
                domainScores[domainKey].total++;
                
                if (userAnswer !== undefined) {
                    const isCorrect = question.multiSelect 
                        ? arraysEqual(userAnswer.sort(), question.correct.sort())
                        : userAnswer === question.correct;
                    
                    if (isCorrect) {
                        totalCorrect++;
                        domainScores[domainKey].correct++;
                    }
                }
            });
            
            return {
                totalCorrect,
                totalQuestions: questions.length,
                percentage: Math.round((totalCorrect / questions.length) * 100),
                domainScores
            };
        }

        // Show results
        function showResults(results) {
            document.getElementById('results').classList.add('show');
            
            // Update score display
            document.getElementById('scoreNumber').textContent = results.totalCorrect;
            document.getElementById('scorePercentage').textContent = `${results.percentage}%`;
            document.getElementById('correctCount').textContent = results.totalCorrect;
            
            // Show domain results
            const domainResultsContainer = document.getElementById('domainResults');
            domainResultsContainer.innerHTML = '';
            
            Object.keys(results.domainScores).forEach(domainKey => {
                const score = results.domainScores[domainKey];
                const percentage = score.total > 0 ? Math.round((score.correct / score.total) * 100) : 0;
                
                const domainDiv = document.createElement('div');
                domainDiv.className = 'domain-result';
                domainDiv.innerHTML = `
                    <div>
                        <strong>Domain ${domainKey}: ${domainInfo[domainKey].name}</strong>
                        <div>${score.correct} of ${score.total} correct</div>
                    </div>
                    <div style="text-align: right;">
                        <strong>${percentage}%</strong>
                        <div class="progress-bar" style="width: 100px; margin-top: 5px;">
                            <div class="progress-fill" style="width: ${percentage}%; background: ${percentage >= 70 ? '#27ae60' : percentage >= 60 ? '#f39c12' : '#e74c3c'}"></div>
                        </div>
                    </div>
                `;
                domainResultsContainer.appendChild(domainDiv);
            });
            
            // Generate recommendations
            generateRecommendations(results);
        }

        // Generate study recommendations
        function generateRecommendations(results) {
            const recommendations = [];
            
            // Overall performance
            if (results.percentage >= 80) {
                recommendations.push("ðŸŽ‰ Excellent performance! You're well-prepared for the PMP exam.");
            } else if (results.percentage >= 70) {
                recommendations.push("âœ… Good performance! Review weak areas and take additional practice tests.");
            } else if (results.percentage >= 60) {
                recommendations.push("âš ï¸ Fair performance. Focus on your weak domains and study fundamental concepts.");
            } else {
                recommendations.push("ðŸ“š More study needed. Consider additional training and focus on all domains.");
            }
            
            // Domain-specific recommendations
            Object.keys(results.domainScores).forEach(domainKey => {
                const score = results.domainScores[domainKey];
                const percentage = score.total > 0 ? (score.correct / score.total) * 100 : 0;
                
                if (percentage < 70) {
                    const domainName = domainInfo[domainKey].name;
                    switch(domainKey) {
                        case 'I':
                            recommendations.push(`ðŸ‘¥ ${domainName}: Focus on team leadership, conflict resolution, and stakeholder engagement. Practice servant leadership scenarios.`);
                            break;
                        case 'II':
                            recommendations.push(`âš™ï¸ ${domainName}: Review project planning, execution, monitoring, and control processes. Study earned value management and risk management.`);
                            break;
                        case 'III':
                            recommendations.push(`ðŸ¢ ${domainName}: Study compliance requirements, business value delivery, and organizational change management.`);
                            break;
                    }
                }
            });
            
            // Study resources
            recommendations.push("ðŸ“– Recommended study materials: PMBOK Guide 7th Edition, Agile Practice Guide, and additional practice tests.");
            
            document.getElementById('recommendationText').innerHTML = 
                recommendations.map(rec => `<p>${rec}</p>`).join('');
        }

        // Restart test
        function restartTest() {
            // Reset all state
            currentTest = 1;
            currentQuestionIndex = 0;
            userAnswers = {};
            testStartTime = null;
            timeRemaining = 230 * 60;
            testCompleted = false;
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Clear saved progress
            localStorage.removeItem('pmp_test_progress');
            
            // Hide results and show test selection
            document.getElementById('results').classList.remove('show');
            document.getElementById('testInterface').style.display = 'none';
            document.getElementById('testSelection').style.display = 'block';
            
            // Reset timer display
            document.getElementById('timer').textContent = '230:00';
            document.getElementById('timer').style.background = '#e74c3c';
        }

        // Utility function to compare arrays
        function arraysEqual(a, b) {
            if (a.length !== b.length) return false;
            for (let i = 0; i < a.length; i++) {
                if (a[i] !== b[i]) return false;
            }
            return true;
        }

        // Handle page visibility change (save progress when tab is hidden)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && !testCompleted) {
                saveProgress();
            }
        });

        // Handle page unload (save progress)
        window.addEventListener('beforeunload', () => {
            if (!testCompleted) {
                saveProgress();
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
        });

        // Handle keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('testInterface').style.display === 'block') {
                switch(e.key) {
                    case 'ArrowLeft':
                        if (!document.getElementById('prevBtn').disabled) {
                            previousQuestion();
                        }
                        break;
                    case 'ArrowRight':
                        if (!document.getElementById('nextBtn').disabled) {
                            nextQuestion();
                        }
                        break;
                    case 'Enter':
                        if (!document.getElementById('submitBtn').disabled) {
                            submitAnswer();
                        }
                        break;
                    case '1':
                    case '2':
                    case '3':
                    case '4':
                    case '5':
                        const optionIndex = parseInt(e.key) - 1;
                        const question = testQuestions[currentTest][currentQuestionIndex];
                        if (optionIndex < question.options.length) {
                            selectOption(optionIndex);
                        }
                        break;
                }
            }
        });
    </script>
</body>
</html>
